const backendUrl = "https://3dtoystore-backend-production-b64c.up.railway.app";

const products = [
  { id: "keyholder", name: "Key Holder", price: 1.50 },
  { id: "penholder", name: "Pen Holder", price: 3.50 },
  { id: "deskorganizer", name: "Desk Organizer", price: 3.50 },
  { id: "phonestand", name: "Phone Stand", price: 2.50 },
  { id: "cableclips", name: "Cable Clips", price: 1.50 },
  { id: "headstand", name: "Clip-on Headphone Stand", price: 4.50 },
  { id: "pocketcopter", name: "Pocket Copter", price: 2.00 },
  { id: "bmwkeychain", name: "BMW Keychain", price: 1.50 },
  { id: "sdholder", name: "SD & MicroSD Holder", price: 3.50 },
  { id: "lehtisaari", name: "Lehtisaari Keychain", price: 5.00 }
];

let cart = [];

function renderProducts() {
  const container = document.getElementById("products");
  container.innerHTML = "";
  products.forEach(p => {
    const div = document.createElement("div");
    div.className = "product";
    div.innerHTML = `
      <h3>${p.name}</h3>
      <p>€${p.price.toFixed(2)}</p>
      <button onclick="addToCart('${p.id}')">Add to Cart</button>
    `;
    container.appendChild(div);
  });
}

function addToCart(id) {
  const product = products.find(p => p.id === id);
  cart.push(product);
  updateCart();
  alert(`${product.name} has been added to your cart!`);
}

function updateCart() {
  document.getElementById("cart-count").textContent = cart.length;

  const itemsList = document.getElementById("cart-items");
  itemsList.innerHTML = "";
  let total = 0;

  cart.forEach((item, index) => {
    total += item.price;
    const li = document.createElement("li");
    li.textContent = `${item.name} - €${item.price.toFixed(2)}`;
    itemsList.appendChild(li);
  });

  document.getElementById("cart-total").textContent = `Total: €${total.toFixed(2)}`;
}

document.getElementById("cart-button").addEventListener("click", () => {
  document.getElementById("cart").classList.toggle("hidden");
});

document.getElementById("checkout").addEventListener("click", async () => {
  if (cart.length === 0) {
    alert("Your cart is empty!");
    return;
  }

  try {
    const res = await fetch(`${backendUrl}/create-checkout-session`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ items: cart })
    });

    const data = await res.json();
    if (data.url) {
      window.location = data.url;
    } else {
      alert("Error creating checkout session.");
    }
  } catch (err) {
    console.error(err);
    alert("Error connecting to server.");
  }
});

renderProducts();
